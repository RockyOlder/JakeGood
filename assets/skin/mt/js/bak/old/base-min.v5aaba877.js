M.add("www-base",function(e){var t=e.Node,o=e.io,n=e.UA.ie,a=e.mt.util,i=a.Cookie,l=e.mt.ScrollLoader.Image;e.namespace("mt.www"),e.mt.www={init:function(){var t=e.mt.www;e.use("www-ajax",function(){t.Ajax.init()}),e.use("www-header","www-tips","www-recommend",function(){t.Header.init(),t.Tips.init(),t.Recommend.initNavRecentlyViewed()}),t.CartEx.init(),l.init({offset:400}),e.mt.widget.init(),e.on("domready",function(){e.mt.ComponentHub.boot()}),e.one(".J-async-deallist")&&t.DealLoader.init(".J-mall"),M.loadQueue.push(function(){e.use("www-base",function(){t.loadLazyIcon(),t.initFavorite(),t.removeUnionCookie()});var o;e.one(document.body).delegate("click",function(t){t.preventDefault(),o?o.open():e.use("www-dialog",function(){o=e.mt.www.Dialog.help()})},".J-lift-help")}),e.use("www-hub",function(e){e.mt.www.Hub.init()}),t.detectWebp()},detectWebp:function(){if(window.localStorage&&"object"==typeof localStorage){var e="webpa";if(!localStorage.getItem(e)||"available"!==localStorage.getItem(e)&&"disable"!==localStorage.getItem(e)){var t=document.createElement("img");t.onload=function(){try{localStorage.setItem(e,"available")}catch(t){}},t.onerror=function(){try{localStorage.setItem(e,"disable")}catch(t){}},t.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAsAAAABBxAREYiI/gcAAABWUDggGAAAADABAJ0BKgEAAQABABwlpAADcAD+/gbQAA=="}}},getMTEventAttr:function(t,o){if(o=o||"trigger",!t)return"";var n="trigger"===o?" data-mtevent":" data-mteventnd";return n+"='"+e.JSON.stringify(t)+"'"},showGeoMask:function(t,o){o=o||".item",e.one(t).delegate("hover",function(){var e=this.one(".trade-geo");e&&e.addClass("geo-hover")},function(){var e=this.one(".trade-geo");e&&e.removeClass("geo-hover")},o)},storeScrollInfo:function(t){if(t=e.one(t)){var o=M.window,n=a.Cookie.getExpiresDate(0,0,10),i="dsy",l=50,r=o.get("pageYOffset"),s=a.Cookie.get(i);s>0&&(s-r>l&&window.scrollTo(o.get("pageXOffset"),s),a.Cookie.remove(i,"/","."+M.DOMAIN_HOST)),t.delegate("click",function(){var e=o.get("pageYOffset"),t=this.getAttribute("target");"_blank"!==t&&a.Cookie.set(i,e,n,"/","."+M.DOMAIN_HOST)},"a")}},initRecoSlides:function(t,o,n){var a=e.one(t);if(a){var i,l={srcNode:a,effect:"slideHorizontal",duration:400,lazyloading:!0,pnAutoHide:!0,sheetContainer:a.one(".reco-slides__slides")};return n&&e.mix(l,n,!0),/\bcircle\b/.test(o)?l.triggerContainer=a.one(".reco-slides__switch"):/\bnumber\b/.test(o)&&(l.triggerContainerEx=a.one(".reco-slides__tips")),/\bblacksquare\b/.test(o)?(l.previous=a.one(".reco-slides__roll--blacksquare--previous"),l.next=a.one(".reco-slides__roll--blacksquare--next")):/\bgreyrect\b/.test(o)?(l.previous=a.one(".reco-slides__roll--greyrect--previous"),l.next=a.one(".reco-slides__roll--greyrect--next"),l.pnAutoHide=!1):/\bgradientrect\b/.test(o)&&(l.previous=a.one(".reco-slides__roll--gradientrect--previous"),l.next=a.one(".reco-slides__roll--gradientrect--next")),i=new e.mt.widget.Slider(l),i.render(),i}},trackPageScroll:function(t){function o(){var e=i.get("pageYOffset");e>c.vt&&(c.vt=e)}function n(){c.vh=i.get("innerHeight"),c.dh=i.get("docHeight"),e.mt.beacon.localEventlog(l,r,t,c)}var i=M.window,l="UserAction",r="Scroll",s=e.one(document.body),c={vh:0,vt:i.get("pageYOffset"),dh:0,clk:0};i.scroll(o,6);var d=s.delegate("click",function(){c.clk=1,d.detach()},"a");a.addUnloadListener(n)},selectAndCopy:function(t,o,a){function i(){try{e.use("www-dialog",function(e){window.clipboardData.setData("Text",t.get("value")),e.mt.www.Dialog.alert(a)})}catch(o){}window.setTimeout(function(){t.select()},0)}t=e.one(t),o=e.one(o),t&&o&&(a=a||"复制成功，您可以粘帖到QQ中发给好友。",n?o.on("click",i):e.use("w-flashcopy","www-dialog",function(){new e.mt.widget.FlashCopy({copyTarget:t,onComplete:function(){t.select(),e.mt.www.Dialog.alert(a)},node:o})}))},removeUnionCookie:function(){if(window.top===window.self){var e=a.Cookie,t="us",o="tjxb",n=e.get(t);n===o&&e.remove(t,"/","."+M.DOMAIN_HOST)}},refreshCaptcha:function(t,o){function n(){var e=r.get("src").replace(/(\?0\.\d+)?$/,"");r.set("src",e+"?"+Math.random()),i.set("value","")}if(t=e.one(t),!t)return null;var i=a.field(t,"captcha"),l=i&&i.next("a"),r=i&&i.next("img");return i&&l&&r?(o&&n(),l.on("click",function(e){e.halt(),n()}),r.on("click",function(){n()}),{update:n}):null},initFeedback:function(o){var n,a;o=o||{},e.mix(o,{mainAreaWidth:980,bottomOffset:20,minScrollTop:0,bottomEdge:".site-info-w",text:"<i></i><span>意见反馈<span>",ga:"",extraClass:""}),o.url&&(o.ga&&(o.ga=' gaevent="'+o.ga+'"'),a='<a target="_blank" class="new-index-triffle lift-nav lift-nav--feedback '+o.extraClass+'" hidefocus="true"'+o.ga+' href="'+o.url+'">'+o.text+"</a>",n=t.create('<div class="new-index-triffle-w" style="display:none">'+a+"</div>"),e.one("body").prepend(n),e.use("uix-sticky",function(e){new e.mt.uix.Sticky(n,{canDisappear:!0,mainAreaWidth:o.mainAreaWidth,bottomEdge:o.bottomEdge,hAlign:"right",vAlign:"bottom",vMinScrollTop:o.minScrollTop,vBottomOffset:o.bottomOffset})}))},initHelp:function(o){var n,a;o=o||{},e.mix(o,{mainAreaWidth:980,bottomOffset:20,minScrollTop:0,bottomEdge:".site-info-w",text:"<i></i><span>帮助中心<span>",ga:"lift/helpcenter"}),o.ga&&(o.ga=' gaevent="'+o.ga+'"'),a='<a class="J-lift-help new-index-triffle lift-nav lift-nav--help" hidefocus="true"'+o.ga+' href="javascript:void(0)">'+o.text+"</a>",n=t.create('<div class="new-index-triffle-w" style="display:none">'+a+"</div>"),e.one("body").prepend(n),e.use("uix-sticky",function(e){new e.mt.uix.Sticky(n,{canDisappear:!0,mainAreaWidth:o.mainAreaWidth,bottomEdge:o.bottomEdge,hAlign:"right",vAlign:"bottom",vMinScrollTop:o.minScrollTop,vBottomOffset:o.bottomOffset})})},goTop:function(o){M.loadQueue.push(function(){var n,a,i;o=o||{},e.mix(o,{mainAreaWidth:980,bottomEdge:".site-info-w",content:"",bottomOffset:20,vMinScrollTop:140}),i=o.gaEvent?' gaevent="'+o.gaEvent+'"':"",a=o.content+'<a class="J-go-top lift-nav new-index-triffle" hidefocus="true" href="javascript:void(0)"'+i+"><i></i><span>回到顶部</span></a>",n=t.create('<div class="new-index-triffle-w" style="display:none">'+a+"</div>"),e.one("body").prepend(n),e.use("uix-smoothscroll","uix-sticky",function(e){e.mt.uix.Smoothscroll(n,{trigger:".J-go-top"}),new e.mt.uix.Sticky(n,{canDisappear:!0,mainAreaWidth:o.mainAreaWidth,bottomEdge:o.bottomEdge,hAlign:"right",vAlign:"bottom",vMinScrollTop:o.vMinScrollTop,vBottomOffset:o.bottomOffset})})})},initFavorite:function(){function t(){if(o)try{window.external.addFavorite(n,a)}catch(t){try{window.sidebar.addPanel(a,n,"")}catch(i){e.use("www-dialog",function(e){e.mt.www.Dialog.alert(l)})}}}var o=e.one("#J-favorite"),n="http://www.meituan.com?utm_campaign=home&utm_medium=free&utm_source=Favorites",a="美团网-美团一次 美一次",i=-1!==window.navigator.userAgent.toLowerCase().indexOf("mac")?"Command":"Ctrl",l="抱歉，您的浏览器不支持此操作。\n请使用按键 "+i+"+D 收藏美团。";o&&o.on("click",t)},initLotteryScroll:function(){var t=e.one("#lottery-list"),o=800,n=4e3;t&&(t.plug(e.mt.plugin.Effect),t.effect.roll("ul",o,n))},disableButton:function(t,o){if(t=e.one(t)){var n="btn-disabled";o="undefined"==typeof o?!0:o,t.set("disabled",o),o?t.addClass(n):t.removeClass(n)}},initStickQrcode:function(t){var o=e.one(".stick-qrcode"),n="stick-qrcode";if(!i.get(n)&&o){var a,l={vAlign:"top",vTopOffset:200,hAlign:"right",vBottomOffset:140,bottomEdge:".site-info-w",topEdge:"#bdw",hideWhenTooNarrow:!0,followScrolling:!0};return t&&e.mix(l,t,!0),"undefined"==typeof l.topEdge&&(l.topEdge=e.one(".site-mast__site-nav-w").getY()+89),o.delegate("click",function(e){e.halt();var t=i.getExpiresDate(1,0,0);o.remove(!0),"undefined"!=typeof a&&a.destroy(),i.set(n,"1",t,"/","."+M.DOMAIN_HOST)},".close"),l.followScrolling!==!0?void o.setStyles({top:l.topEdge,position:"absolute",display:"inline"}):void e.use("uix-sticky",function(e){a=new e.mt.uix.Sticky(o,l)})}},initSimpleQrcode:function(){var t=e.one(".simple-stick-qrcode"),o="stick-qrcode";!i.get(o)&&t&&(t.show(),t.delegate("click",function(e){e.halt();var n=i.getExpiresDate(1,0,0);t.remove(!0),i.set(o,"1",n,"/","."+M.DOMAIN_HOST)},".close"))},loadLazyIcon:function(t,o){var n=o||"data-lazyicon";t=e.one(t||"body"),t&&t.all("["+n+"]").each(function(e){var t=e.getAttribute(n);t&&(e.addClass(t),e.removeAttribute(n))})},CartEx:{init:function(){var t=e.one("#J-my-cart"),o=t&&t.one("#J-my-cart-menu");o&&this.bindNavDelete()},bindNavDelete:function(){function t(t){if("/cart/"===window.location.pathname||/^\/cart\/default\//.test(window.location.pathname))return void(window.location.href="/cart/");var o=t.ancestor(".dropdown-menu__item"),a=o.ancestor(),l=n.one(".badge"),r=parseInt(l.get("text"),10)-1;o.plug(e.mt.plugin.Effect),o.effect.fadeOut(!0,200,function(){var e,t,o=0;return i.updateCount(r),0===r?void a.ancestor(".dropdown-menu").setHTML(i.getEmptyTips()):(t=n.one(".cart-discription"),void(t&&(e=t.one(".cart-deal-num"),o=parseInt(e.getHTML(),10),1===o&&(t.hide(),a.removeClass("long-list")),o--,0>o&&(o=0),e.setHTML(o))))})}var n=e.one("#J-my-cart"),i=this,l=null;n.delegate("click",function(e){if(e.preventDefault(),!l||!l.isInProgress()){var n=this;l=o("/cart/remove",{method:"POST",data:a.toPostData({cartItem:a.data(n,"id")+"-"+a.data(n,"calendarid")}),on:{success:function(e,o){var i=a.getEvalRes(o);i.status&&t(n)}}})}},".delete")},updateCount:function(t){var o,n=e.one("#J-my-cart");n&&(o=n.one(".badge"),!o&&t>0&&n.one("#J-my-cart-toggle").append('<em class="badge"><strong class="cart-count">'+t+"</strong>件</em>"),o&&o.setHTML('<strong class="cart-count">'+t+"</strong>件"))},getEmptyTips:function(){return'<p class="dropdown-menu--empty">暂时没有商品</p>'},updateDropdownList:function(){var t=e.one("#J-my-cart"),n=t.one("#J-my-cart-menu"),i="dropdown-menu--loaded",l="/index/cartdeals",r=this,s=null;return n.addClass(i)||n.addClass(i),s=o(l,{method:"GET",on:{success:function(e,t){var o=a.getEvalRes(t);o.data&&r.update(o.data)}}})},update:function(t){var o,n=e.one("#J-my-cart"),a=n.one("#J-my-cart-menu"),i="dropdown-menu--loading",l="dropdown-menu__item",r=this,s=5,c=[],d=' gaevent="nav/cart/{index}/photo"',u=' gaevent="nav/cart/{index}/title"',f='<a href="{url}" title="{title}" target="_blank" rel="nofollow" class="deal-link"'+d+'>    <img class="deal-cover" src="{imgUrl}" width="80" height="50" /></a><h5 class="deal-title"><a href="{url}" title="{title}" target="_blank" rel="nofollow" class="deal-link"'+u+'>{title}</a></h5><p class="deal-price-w"><a href="javascript:void(0);" data-id="{dealid}" data-calendarid="{calendarid}" class="delete link--black__green">删除</a><em class="deal-price">¥{price}</em></p>';r.updateCount(t.length),t.length?(o=t.length>s,c.push('<ul class="list-wrapper'+(o?" long-list":"")+'">'),e.Array.each(t,function(t,o){c.push('<li class="'+l+'">'),c.push(e.Lang.sub(f,{url:t.url,title:t.title,price:t.price,imgUrl:t.imgurl,dealid:t.dealid,calendarid:t.calendarid,index:o+1})),c.push("</li>")}),c.push("</ul>"),o&&c.push('<p class="cart-discription">购物车里还有<span class="cart-deal-num">'+(t.length-s)+"</span>个团购</p>"),c.push('<p class="check-my-cart"><a href="/cart/" class="btn btn-hot btn-small" gaevent="nav/cart/checkbutton">查看我的购物车</a></p>')):c.push(r.getEmptyTips()),a.removeClass(i).setHTML(c.join(""))}},trackApiTiming:function(t,o,n){if(window.mta&&t&&t.request){var a=e.Lang.now()-o,i=t.request,l={};l[n]={latency:a-i,backend:i},window.mta("timing","api",l)}},trackFeatureTiming:function(e,t){if(window.mta&&t){var o={};o[e]=t,window.mta("timing","feature",o)}}},e.mt.www.REG={email:/^[\w\.\-\+]+@([\w\-]+\.)+[a-z]{2,4}$/i,username:/^[\.\w\u4e00-\u9fa5\uF900-\uFA2D]{2,16}$/i,password:/^[\x21-\x7e]{6,32}$/i,mobile:/^\d{11}$/},e.mt.www.DealLoader=function(){function t(o){var n=this;this.conf=e.merge({},t.DEFAULT_CONF),this.cbs=e.merge({},t.DEFAULT_CBS),o&&(o.loadThreshold&&(o.loadThreshold=+o.loadThreshold||0),o.initialLoad&&(o.initialLoad=+o.initialLoad||0),o.dealsPerLoad&&(o.dealsPerLoad=+o.dealsPerLoad||0),this.conf=e.merge(this.conf,o),o.on&&(e.Object.each(o.on,function(e,t){n.cbs[t]&&"function"==typeof e&&(n.cbs[t]=[].concat(n.cbs[t],e))}),delete n.conf.on))}var n=M.window;return t.DEFAULT_CONF={action:"/index/deallist",dealsPerLoad:36,initialLoad:0,loadThreshold:2,disableLoadingEffect:!1,minInterval:6,ndWrapper:null,seqNo:0,offset:0},t.DEFAULT_CBS={beforeRequest:function(){var t=this.conf,o=t.ndWrapper,n=t.ndLoading;t.disableLoadingEffect||(n?n.show():(t.ndLoading=e.Node.create('<div class="deals-async-loading"><div class="deals-async-loading__tips"><i></i>加载中</div></div>'),o.insert(t.ndLoading,"after")))},beforeContentReady:function(t,o){e.mt.www.trackApiTiming(t.bem||null,o.reqStart,"mall-deallist")},contentReady:function(){e.mt.ScrollLoader.Image.init({ndContainer:this.conf.ndWrapper,offset:400})},stop:function(){var e=this.conf;e.resizeHandle&&e.resizeHandle.detach(),e.scrollHandle&&e.scrollHandle.detach(),e.ndLoading&&e.ndLoading.hide(),this.stopped=!0}},t.prototype={run:function(){if(!this.stopped){var e=this.conf,t=this;this.check(),e.resizeHandle=n.resize(function(){t.check()},e.minInterval),e.scrollHandle=n.scroll(function(){t.check()},e.minInterval)}},check:function(){var e=this.conf;if(e&&!e.isLocked){var t=n.get("pageYOffset"),o=n.get("innerHeight"),a=e.ndWrapper.getY(),i=e.ndWrapper.get("offsetHeight"),l=o*e.loadThreshold;l>a+i-t&&this.load()}},load:function(){var t,n,i=this,l=i.conf,r=l.deals,s=r&&r.length||0;if(l&&!l.isLocked){if(l.isLocked=!0,n=l.data||{},n.params&&"object"==typeof n.params&&(n.params=e.JSON.stringify(n.params)),n.offset=l.offset,l.offset+=l.dealsPerLoad,!(n.offset<s))return void i.call("stop");n.dealids=r.slice(n.offset,l.offset).join(","),l.acms&&(n.acms=l.acms.slice(n.offset,l.offset).join(",")),l.seqNo++,i.call("beforeRequest"),t=Date.now(),o(l.action,{method:"post",data:n,on:{success:function(e,o){var n=a.getEvalRes(o);n.status&&n.data?(i.call("beforeContentReady",n,{reqStart:t}),l.ndWrapper.append(n.data),n.recvTrackData&&window._mbq("sendReclsView",n.recvTrackData),i.call("contentReady"),l.isLocked=!1):i.call("stop")},failure:function(){i.call("stop")}}})}},call:function(e){var t,o=this.cbs[e],n=Array.prototype.slice.call(arguments,1);if("function"==typeof o)o.apply(this,n);else for(t=o.length-1;t>=0&&o[t].apply(this,n)!==!1;)t--}},{init:function(o,n){n=n||{};var i,l,r=e.one(o),s=n.stampClass||"J-async-deallist",c=n.conf||{},d=r&&r.one("."+s);d&&(c.ndWrapper=d,!c.dealids&&M.ASYNC_PAGE_VIEW_DATA&&M.ASYNC_PAGE_VIEW_DATA.deals&&(c.dealids=M.ASYNC_PAGE_VIEW_DATA.deals,M.ASYNC_PAGE_VIEW_DATA.acms&&(c.acms=M.ASYNC_PAGE_VIEW_DATA.acms)),c.dealids&&(M.loadQueue.push(function(){e.use("mt-beacon",function(e){e.mt.beacon.asynclog({deals:c.dealids})})}),c.deals=c.dealids.split(",")),i=d.getAttribute("data-async-params"),i&&(i=a.decodeJSON(i),i&&e.mix(c,i,!0)),+c.initialLoad&&(c.offset=+c.initialLoad),l=new t(c),c.loadOneShotImmediately&&l.load(),l.run())}}}(),e.mt.www.CTRTracker={logView:function(t){function o(e){e.hasClass("log-mod-viewed")||(e.addClass("log-mod-viewed"),i.push(e.getAttribute(n)))}var n="data-mod",a=e.all(t),i=[];a.each(function(e){e.hasAttribute(n)&&o(e),e.all("["+n+"]").each(o)}),i.length&&e.use("mt-log",function(e){e.mt.log.moduleview({pm:i.join("")})})}},e.mt.www.RecViewTracker={logView:function(t){t=e.one(t);var o,n="data-recv",a=t.all("[data-recv]"),i=[];a.push(t),a.each(function(e){o=e.getAttribute(n),o&&(i.push(o),e.removeAttribute(n))}),window._mbq("sendReclsView",i.join(","))}},e.mt.www.Iframe=function(){return{scrollTop:function(){window.top!==window.self&&window.top.scroll(0,0)},setParentHeight:function(){var t,o="mtcrossdomain-height";if(window.top!==window.self){t=n?document.documentElement.scrollHeight:parseInt(e.one(document.body).getStyle("height"),10),(!t||1134>t)&&(t=1134);var a=window.top.document.getElementById(o);a&&(a.style.height=t+"px")}}}}(),M.loadQueue.push(function(){M._autoinit.push(function(t){e.mt.www.loadLazyIcon(t),e.mt.www.CTRTracker.logView(t),e.mt.www.RecViewTracker.logView(t)})}),M._autoinit.push(function(t){e.mt.widget.init(t)}),M.loadQueue.push(function(){e.use("node",function(){e.mt.www.CTRTracker.logView("body"),e.mt.www.RecViewTracker.logView("body")})}),e.applyConfig({skin:{overrides:{"w-date":["uiguide"]}}})},"1.0.0",{requires:["mt-base","mt-component","mt-window","mt-scrollloader","io-base","io-form","p-node-placeholder","p-node-effect"]});